<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>KING PREDICTOR â€” Premium AI (Live Upgrade)</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;800&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --bg-1:#050405;
  --bg-2:#0f0d0d;
  --accent:#ff2e2e; /* red */
  --accent-2:#b30000;
  --glass: rgba(255,255,255,0.03);
  --muted: rgba(255,255,255,0.7);
  --neon: rgba(255,46,46,0.14);
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;width:100%;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;background:
  radial-gradient(900px 400px at 10% 10%, rgba(179,0,0,0.03), transparent 6%),
  linear-gradient(180deg,var(--bg-1),var(--bg-2));color:#fff;overflow:hidden}

/* container */
.app{max-width:1200px;margin:18px auto;padding:18px;display:grid;grid-template-columns:1fr 380px;gap:22px;align-items:start;position:relative;z-index:2}
@media(max-width:1000px){.app{grid-template-columns:1fr;padding:12px}}

.card{background:linear-gradient(180deg, rgba(255,255,255,0.015), rgba(0,0,0,0.02));border-radius:14px;padding:18px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 20px 60px rgba(0,0,0,0.7);position:relative;overflow:hidden}
.header{display:flex;align-items:center;gap:12px;margin-bottom:12px}
.logo{width:64px;height:64px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:grid;place-items:center;box-shadow:0 0 40px rgba(255,46,46,0.06)}
.logo svg{width:36px;height:36px}
.title{font-family:Orbitron, sans-serif;font-weight:800;font-size:20px;color:var(--accent);letter-spacing:0.6px}
.subtitle{font-size:12px;color:#ffbdbd}

/* left */
.left{padding:12px;border-radius:12px}
.timer-grid{display:flex;gap:18px;align-items:center}
.ring{width:170px;height:170px;display:grid;place-items:center;position:relative}
.ring svg{width:100%;height:100%}
.ring .center{width:108px;height:108px;border-radius:999px;background:linear-gradient(180deg,#0e0e0e, #0b0b0b);display:grid;place-items:center;font-weight:900;font-size:22px;color:#ffbdbd;border:1px solid rgba(255,255,255,0.02);box-shadow:0 10px 30px rgba(179,0,0,0.06);transform:translateZ(0)}
.status{flex:1}
.status .label{font-size:12px;color:var(--muted);letter-spacing:1px}
.status .period{margin-top:6px;font-weight:800;color:#ffbdbd;word-break:break-all}

/* AI hologram */
.holo-wrap{position:relative;width:100%;display:flex;gap:16px;align-items:center}
.holo{width:120px;height:120px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.03);display:grid;place-items:center;box-shadow:0 16px 40px rgba(179,0,0,0.05);position:relative;overflow:visible}
.holo::before{content:'';position:absolute;inset:-30%;background:radial-gradient(closest-side, rgba(255,46,46,0.06), transparent 40%);filter:blur(20px);opacity:0.9}
.holo .face{width:64px;height:64px;border-radius:6px;background:linear-gradient(135deg,#3b0b0b, #120202);display:grid;place-items:center;font-weight:900;color:#ffd6d6;transform:translateZ(0);}
.holo .scan{position:absolute;left:0;right:0;height:6px;top:50%;transform:translateY(-50%);background:linear-gradient(90deg, transparent, rgba(255,255,255,0.06), transparent);opacity:.6;animation:scan 2.6s linear infinite}
@keyframes scan{0%{left:-40%}100%{left:140%}}

/* prediction card */
.pred-card{margin-top:14px;padding:16px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.03));border:1px solid rgba(255,255,255,0.02);position:relative;overflow:visible}
.pred-title{font-size:13px;color:#ffd6d6}
.pred-val{font-size:52px;font-weight:900;color:var(--accent);text-shadow:0 0 40px rgba(255,46,46,0.08);display:flex;align-items:center;justify-content:center;gap:12px;transition:transform .35s cubic-bezier(.2,.9,.2,1),opacity .25s}
.pred-val.small{color:#7be0ff;text-shadow:0 0 28px rgba(123,224,255,0.06)}
.pred-sub{font-size:12px;color:#ffdede;margin-top:8px;text-align:center}

/* confidence meter */
.conf{display:flex;align-items:center;gap:12px;margin-top:12px}
.meter{height:14px;background:rgba(255,255,255,0.03);border-radius:999px;overflow:hidden;width:260px;border:1px solid rgba(255,255,255,0.02)}
.meter .fill{height:100%;width:0;background:linear-gradient(90deg,var(--accent),var(--accent-2));transition:width .6s ease}
.conf .num{font-weight:700;color:#ffcfcf}

/* right */
.right{padding:12px;border-radius:12px}
.panel-title{font-weight:800;color:var(--accent);margin-bottom:8px}
.stats{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.stat{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));padding:12px;border-radius:10px;text-align:center;border:1px solid rgba(255,255,255,0.02)}
.stat h4{font-size:12px;color:#ffd6d6;margin-bottom:8px}
.stat .num{font-size:28px;font-weight:900}

.small{font-size:12px;color:#f4b3b3;margin-top:12px;text-align:center}

/* subtle glow lines */
.glow-lines{position:absolute;inset:0;pointer-events:none;mix-blend-mode:screen}
.glow-lines svg{width:110%;height:110%;opacity:0.06}

/* animations */
@media (prefers-reduced-motion: no-preference){
  .pred-val{transform:translateY(8px);opacity:0}
  .pred-val.show{transform:translateY(0);opacity:1}
}

@media(max-width:720px){
  .pred-val{font-size:36px}
  .ring{width:140px;height:140px}
  .holo{display:none}
}

/* modal kept for confirm (hidden by UI) */
.modal-back{position:fixed;inset:0;background:rgba(0,0,0,0.7);display:none;align-items:center;justify-content:center;z-index:9999}
.modal{width:92%;max-width:520px;background:#fff;padding:18px;border-radius:12px;color:#111;border:3px solid transparent;border-image: linear-gradient(90deg,var(--accent),var(--accent-2)) 1;text-align:center}

</style>
</head>
<body>

<!-- background particles + wave -->
<canvas id="particles" style="position:fixed;left:0;top:0;width:100%;height:100%;pointer-events:none;z-index:0" aria-hidden="true"></canvas>
<div class="glow-lines" aria-hidden="true">
  <svg viewBox="0 0 1600 900" preserveAspectRatio="none">
    <defs><linearGradient id="g" x1="0" x2="1"><stop offset="0" stop-color="#ff2e2e" stop-opacity="1"/><stop offset="1" stop-color="#b30000" stop-opacity="1"/></linearGradient></defs>
    <path d="M0 700 C400 500 800 900 1600 600 L1600 900 L0 900 Z" fill="url(#g)"></path>
  </svg>
</div>

<div class="app" role="main">
  <section class="card left" aria-labelledby="mainTitle">
    <div class="header">
      <div class="logo" aria-hidden="true">
        <svg viewBox="0 0 512 512"><path d="M496 128L352 192 256 64 160 192 16 128l80 320h320l80-320z" fill="#fff"/></svg>
      </div>
      <div>
        <div id="mainTitle" class="title">KING PREDICTOR â€” PREMIUM</div>
        <div class="subtitle" style="margin-top:6px">Indian Time â€¢ Firebase Live â€¢ Premium AI Look</div>
      </div>
    </div>

    <div class="timer-grid">
      <div class="ring" aria-hidden="false">
        <svg viewBox="0 0 120 120" role="img" aria-label="Timer progress">
          <defs>
            <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0" stop-color="#b30000"/><stop offset="1" stop-color="#ff6b6b"/>
            </linearGradient>
          </defs>
          <circle cx="60" cy="60" r="52" stroke="rgba(255,255,255,0.04)" stroke-width="12" fill="none"></circle>
          <circle id="progressRing" cx="60" cy="60" r="52" stroke="url(#grad1)" stroke-width="12" fill="none" stroke-linecap="round" stroke-dasharray="326.7256" stroke-dashoffset="326.7256" transform="rotate(-90 60 60)"></circle>
        </svg>
        <div class="center" id="ringCenter">60</div>
      </div>

      <div class="status">
        <div class="label">CURRENT PERIOD</div>
        <div class="period" id="periodDisplay">â€”</div>

        <div style="margin-top:10px" class="ai-badge">
          <div style="width:10px;height:10px;border-radius:10px;background:var(--accent-2);margin-right:8px;display:inline-block"></div>
          <div style="font-weight:700;color:#ffcfcf;display:inline-block">AI â€¢ Online (IST sync)</div>
        </div>

        <div class="conf" style="margin-top:12px">
          <div class="meter" aria-hidden="true"><div id="meterFill" class="fill" style="width:0%"></div></div>
          <div class="num" id="confNum">0%</div>
        </div>
      </div>
    </div>

    <div class="holo-wrap" style="margin-top:14px;align-items:center">
      <div class="holo" aria-hidden="true">
        <div class="face">AI</div>
        <div class="scan"></div>
      </div>
      <div style="flex:1">
        <div class="pred-card" aria-live="polite">
          <div class="pred-title">AI PREDICTION</div>
          <div class="pred-val" id="predVal">AI SCANNING...</div>
          <div class="pred-sub" id="predSub">Looking into the live feed â€” hold on.</div>
        </div>
      </div>
    </div>

    <div class="small">Predictions display around 20s of each minute (India time). When a minute ends, confirm result from admin.</div>
  </section>

  <aside class="card right" aria-label="Controls">
    <div class="panel-title">Session Stats</div>

    <div class="stats" style="margin-top:8px">
      <div class="stat"><h4>WINS</h4><div class="num" id="winsNum">0</div></div>
      <div class="stat"><h4>LOSSES</h4><div class="num" id="lossNum">0</div></div>
    </div>

    <div class="small" style="margin-top:12px">Admin panel manages server running and period increments.</div>
  </aside>
</div>

<!-- hidden modal (used by admin) -->
<div id="modalBack" class="modal-back" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="modal" role="document"></div>
</div>

<script type="module">
/* Firebase imports (unchanged) */
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getDatabase, ref, onValue, get, set, update, runTransaction } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDgFIrgJz_YItH_rj_ARNt5REnxPaCxUgo",
  authDomain: "kingpredictor-49c57.firebaseapp.com",
  databaseURL: "https://kingpredictor-49c57-default-rtdb.firebaseio.com/",
  projectId: "kingpredictor-49c57",
  storageBucket: "kingpredictor-49c57.appspot.com",
  messagingSenderId: "936216684661",
  appId: "1:936216684661:web:7568d3c83ad5837e20303c"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const serverRef = ref(db, 'server');
const statsRef = ref(db, 'stats');

/* DOM */
const progressRing = document.getElementById('progressRing');
const ringCenter = document.getElementById('ringCenter');
const meterFill = document.getElementById('meterFill');
const confNum = document.getElementById('confNum');
const periodDisplay = document.getElementById('periodDisplay');
const predVal = document.getElementById('predVal');
const predSub = document.getElementById('predSub');
const winsNum = document.getElementById('winsNum');
const lossNum = document.getElementById('lossNum');

if(progressRing) progressRing.style.strokeDasharray = String(2*Math.PI*52);

/* state */
let server = { running:false, periodNumber:null, timestamp:null };
let stats = { wins:0, losses:0 };
let lastSeenPeriod = null;
let shownPrediction = false;
let lastPrediction = '';
let waitingForConfirm = false;

/* IST helper */
function getIST(){ const now = new Date(); return new Date(now.toLocaleString('en-US', { timeZone: 'Asia/Kolkata' })); }
function pad(n,d=2){ return String(n).padStart(d,'0'); }

/* ensure DB exists */
async function ensureDb(){
  try{
    const s = await get(serverRef);
    if(!s.exists()){
      const now = getIST();
      const init = ${now.getFullYear()}${pad(now.getMonth()+1)}${pad(now.getDate())}${pad(now.getHours())}${pad(now.getMinutes())}${pad(now.getSeconds())}${String(Math.floor(Math.random()*900)+100)};
      await set(serverRef, { running:false, periodNumber: init, timestamp: now.toISOString() });
    }
    const t = await get(statsRef);
    if(!t.exists()){
      await set(statsRef, { wins:0, losses:0 });
    }
  }catch(e){ console.error('ensure db error', e); }
}
ensureDb();

/* listen DB */
onValue(serverRef, (snap)=>{
  if(!snap.exists()) return;
  const v = snap.val();
  server.running = !!v.running;
  server.periodNumber = v.periodNumber ?? server.periodNumber;
  server.timestamp = v.timestamp ?? server.timestamp;
  if(server.periodNumber) periodDisplay.textContent = String(server.periodNumber);
  if(lastSeenPeriod !== null && server.periodNumber !== lastSeenPeriod && shownPrediction && !waitingForConfirm){
    // in upgraded UI we just mark waiting state (admin handles confirm)
    predSub.textContent = 'Awaiting admin confirmation for last period.';
  }
  lastSeenPeriod = server.periodNumber;
});

onValue(statsRef, (snap)=>{
  if(!snap.exists()) return;
  const v = snap.val();
  stats.wins = v.wins || 0;
  stats.losses = v.losses || 0;
  winsNum.textContent = stats.wins;
  lossNum.textContent = stats.losses;
});

/* deterministic generator (same as before) */
function hashString(s){ let h=2166136261>>>0; for(let i=0;i<s.length;i++){ h = Math.imul(h ^ s.charCodeAt(i), 16777619) >>>0; } return h >>> 0; }
function deterministicPred(seed, sec){ const h = hashString(String(seed)); const v = (h ^ sec) % 100; return v >= 50 ? 'BIG' : 'SMALL'; }
function deterministicConf(seed, sec){ const h = hashString(String(seed + 'conf')); const v = (h ^ sec) % 100; return 65 + (v % 30); }

/* animate show prediction */
function revealPrediction(text, conf){
  predVal.classList.remove('show');
  void predVal.offsetWidth; // reflow to restart animation
  predVal.textContent = text;
  predVal.classList.add('show');
  predSub.textContent = Confidence ${conf}% â€” Live AI result;
}

/* main tick (1s) */
const CIRC = 2*Math.PI*52;
setInterval(async ()=>{
  const now = getIST();
  if(!server.timestamp || !server.periodNumber){ ringCenter.textContent='--'; predVal.textContent='Waiting for admin...'; return; }
  const anchorMs = (new Date(server.timestamp)).getTime();
  const elapsed = Math.max(0, Math.floor((getIST().getTime() - anchorMs)/1000));
  const secInto = elapsed % 60;
  const remaining = 60 - secInto;
  ringCenter.textContent = String(remaining).padStart(2,'0');

  const progress = Math.max(0, Math.min(1, secInto/60));
  const offset = Math.round(CIRC * (1 - progress));
  if(progressRing) progressRing.style.strokeDashoffset = offset;

  if(waitingForConfirm) return;
  if(!server.running){ predVal.textContent = 'Server paused'; meterFill.style.width = '0%'; confNum.textContent = '0%'; return; }

  if(secInto < 20){
    // scanning animation with small pulsing confidence wave
    predVal.textContent = 'ðŸ”Ž AI SCANNING...';
    const conf = 30 + Math.abs(Math.sin(Date.now()/1200))*20;
    meterFill.style.width = Math.round(conf) + '%';
    confNum.textContent = Math.round(conf) + '%';
    shownPrediction = false; lastPrediction = '';
  } else {
    if(!shownPrediction){
      const pred = deterministicPred(server.periodNumber, secInto);
      const conf = deterministicConf(server.periodNumber, secInto);
      revealPrediction(pred, conf);
      meterFill.style.width = conf + '%';
      confNum.textContent = conf + '%';
      shownPrediction = true; lastPrediction = pred;
    }
  }
}, 1000);

/* particles effect (upgraded) */
(function particles(){
  const canvas = document.getElementById('particles'); if(!canvas) return;
  const ctx = canvas.getContext('2d'); let w=canvas.width=innerWidth, h=canvas.height=innerHeight;
  const count = Math.max(35, Math.floor((w*h)/110000));
  const arr = Array.from({length:count}).map(()=>{ return {x:Math.random()*w,y:Math.random()*h,r:Math.random()*1.6+0.6,alpha:Math.random()*0.6+0.02,vx:(Math.random()-0.5)*0.6,vy:(Math.random()-0.5)*0.6}; });
  function draw(){ ctx.clearRect(0,0,w,h); for(const p of arr){ p.x += p.vx; p.y += p.vy; if(p.x<0) p.x=w; if(p.x>w) p.x=0; if(p.y<0) p.y=h; if(p.y>h) p.y=0; ctx.beginPath(); ctx.fillStyle = rgba(255,46,46,${p.alpha}); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill(); }
    requestAnimationFrame(draw);
  }
  draw(); addEventListener('resize', ()=>{ w=canvas.width=innerWidth; h=canvas.height=innerHeight; });
})();

// accessibility: don't close modal on backdrop accidental click
const modalBack = document.getElementById('modalBack'); if(modalBack) modalBack.addEventListener('click', (e)=> e.stopPropagation());

</script>
</body>
</html>
